import{j as e,r as l,q as Z,u as ee,$ as te}from"./app-Deg_RhLx.js";import{c as B,u as se,a as ae,R as re,A as oe,b as g,P as q,d as ne,D as le,C as ie,e as ce,f as de,T as ue,g as me,h as pe,X as he,i as xe,j as fe,k as je,O as ge,l as U,m as ve,n as Ne,o as be,p as we,q as Ce}from"./app-layout-B50ZnC3k.js";import{I as ye}from"./input-C8GMpBeQ.js";import{c as L,a as b}from"./createLucideIcon-Bu8_y6Kz.js";import{u as Pe,B as W}from"./app-logo-icon-CM8QltBY.js";import{P as Se}from"./index-CSG2-b6p.js";import{C as _e,F as De}from"./FilePreviewer-CW8f_R8L.js";import{T as Re,a as Te,b as j,c as m}from"./table-Bgmea5il.js";/* empty css            */import"./index-BqMYli15.js";import"./loader-circle-Bad5L_1X.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ke=L("ChevronDown",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Oe=L("ChevronUp",He);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],$e=L("Search",Le);function S({className:t,...a}){return e.jsx("div",{"data-slot":"skeleton",className:b("bg-primary/10 animate-pulse rounded-md",t),...a})}var O,T="HoverCard",[K,ft]=ae(T,[B]),E=B(),[Ae,k]=K(T),G=t=>{const{__scopeHoverCard:a,children:o,open:r,defaultOpen:i,onOpenChange:d,openDelay:u=700,closeDelay:x=300}=t,p=E(a),v=l.useRef(0),h=l.useRef(0),P=l.useRef(!1),N=l.useRef(!1),[C,n]=se({prop:r,defaultProp:i??!1,onChange:d,caller:T}),w=l.useCallback(()=>{clearTimeout(h.current),v.current=window.setTimeout(()=>n(!0),u)},[u,n]),y=l.useCallback(()=>{clearTimeout(v.current),!P.current&&!N.current&&(h.current=window.setTimeout(()=>n(!1),x))},[x,n]),H=l.useCallback(()=>n(!1),[n]);return l.useEffect(()=>()=>{clearTimeout(v.current),clearTimeout(h.current)},[]),e.jsx(Ae,{scope:a,open:C,onOpenChange:n,onOpen:w,onClose:y,onDismiss:H,hasSelectionRef:P,isPointerDownOnContentRef:N,children:e.jsx(re,{...p,children:o})})};G.displayName=T;var V="HoverCardTrigger",Q=l.forwardRef((t,a)=>{const{__scopeHoverCard:o,...r}=t,i=k(V,o),d=E(o);return e.jsx(oe,{asChild:!0,...d,children:e.jsx(Se.a,{"data-state":i.open?"open":"closed",...r,ref:a,onPointerEnter:g(t.onPointerEnter,R(i.onOpen)),onPointerLeave:g(t.onPointerLeave,R(i.onClose)),onFocus:g(t.onFocus,i.onOpen),onBlur:g(t.onBlur,i.onClose),onTouchStart:g(t.onTouchStart,u=>u.preventDefault())})})});Q.displayName=V;var $="HoverCardPortal",[ze,Ue]=K($,{forceMount:void 0}),X=t=>{const{__scopeHoverCard:a,forceMount:o,children:r,container:i}=t,d=k($,a);return e.jsx(ze,{scope:a,forceMount:o,children:e.jsx(q,{present:o||d.open,children:e.jsx(ne,{asChild:!0,container:i,children:r})})})};X.displayName=$;var D="HoverCardContent",Y=l.forwardRef((t,a)=>{const o=Ue(D,t.__scopeHoverCard),{forceMount:r=o.forceMount,...i}=t,d=k(D,t.__scopeHoverCard);return e.jsx(q,{present:r||d.open,children:e.jsx(Fe,{"data-state":d.open?"open":"closed",...i,onPointerEnter:g(t.onPointerEnter,R(d.onOpen)),onPointerLeave:g(t.onPointerLeave,R(d.onClose)),ref:a})})});Y.displayName=D;var Fe=l.forwardRef((t,a)=>{const{__scopeHoverCard:o,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:d,onInteractOutside:u,...x}=t,p=k(D,o),v=E(o),h=l.useRef(null),P=Pe(a,h),[N,C]=l.useState(!1);return l.useEffect(()=>{if(N){const n=document.body;return O=n.style.userSelect||n.style.webkitUserSelect,n.style.userSelect="none",n.style.webkitUserSelect="none",()=>{n.style.userSelect=O,n.style.webkitUserSelect=O}}},[N]),l.useEffect(()=>{if(h.current){const n=()=>{C(!1),p.isPointerDownOnContentRef.current=!1,setTimeout(()=>{var y;((y=document.getSelection())==null?void 0:y.toString())!==""&&(p.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",n),()=>{document.removeEventListener("pointerup",n),p.hasSelectionRef.current=!1,p.isPointerDownOnContentRef.current=!1}}},[p.isPointerDownOnContentRef,p.hasSelectionRef]),l.useEffect(()=>{h.current&&Be(h.current).forEach(w=>w.setAttribute("tabindex","-1"))}),e.jsx(le,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:u,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:g(d,n=>{n.preventDefault()}),onDismiss:p.onDismiss,children:e.jsx(ie,{...v,...x,onPointerDown:g(x.onPointerDown,n=>{n.currentTarget.contains(n.target)&&C(!0),p.hasSelectionRef.current=!1,p.isPointerDownOnContentRef.current=!0}),ref:P,style:{...x.style,userSelect:N?"text":void 0,WebkitUserSelect:N?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})}),Me="HoverCardArrow",Ie=l.forwardRef((t,a)=>{const{__scopeHoverCard:o,...r}=t,i=E(o);return e.jsx(ce,{...i,...r,ref:a})});Ie.displayName=Me;function R(t){return a=>a.pointerType==="touch"?void 0:t()}function Be(t){const a=[],o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;o.nextNode();)a.push(o.currentNode);return a}var qe=G,We=Q,Ke=X,Ge=Y;function F({...t}){return e.jsx(qe,{"data-slot":"hover-card",openDelay:300,...t})}function M({...t}){return e.jsx(We,{"data-slot":"hover-card-trigger",...t})}function I({className:t,align:a="center",sideOffset:o=4,...r}){return e.jsx(Ke,{"data-slot":"hover-card-portal",children:e.jsx(Ge,{"data-slot":"hover-card-content",align:a,sideOffset:o,className:b("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...r})})}const Ve=()=>e.jsxs("div",{className:"p-4",children:[e.jsx(S,{className:"h-6 w-48 mb-4"}),e.jsx(S,{className:"h-10 rounded-md"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4",children:Array.from({length:8}).map((t,a)=>e.jsxs(_e,{className:"p-4",children:[e.jsx(S,{className:"h-6 w-6 mb-2 mx-auto"}),e.jsx(S,{className:"h-4 w-24 mx-auto mb-1"}),e.jsx(S,{className:"h-3 w-20 mx-auto"})]},a))})]});function Qe({...t}){return e.jsx(de,{"data-slot":"dialog",...t})}function Xe({...t}){return e.jsx(ue,{"data-slot":"dialog-trigger",...t})}function Ye({...t}){return e.jsx(je,{"data-slot":"dialog-portal",...t})}function Je({className:t,...a}){return e.jsx(ge,{"data-slot":"dialog-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",t),...a})}function Ze({className:t,children:a,...o}){return e.jsxs(Ye,{"data-slot":"dialog-portal",children:[e.jsx(Je,{}),e.jsxs(me,{"data-slot":"dialog-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[a,e.jsxs(pe,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(he,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function et({className:t,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:b("flex flex-col gap-2 text-center sm:text-left",t),...a})}function tt({className:t,...a}){return e.jsx(xe,{"data-slot":"dialog-title",className:b("text-lg leading-none font-semibold",t),...a})}function st({className:t,...a}){return e.jsx(fe,{"data-slot":"dialog-description",className:b("text-muted-foreground text-sm",t),...a})}const at=({item:t,triggerLabel:a})=>{var d;const[o,r]=l.useState(!1),i=(d=t.download_url)==null?void 0:d.replace("?download=true","").replace("/download","");return e.jsxs(Qe,{open:o,onOpenChange:r,children:[e.jsx(Xe,{asChild:!0,children:e.jsx(W,{asChild:!0,variant:"link",className:"cursor-pointer hover:underline p-0 h-auto",children:e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",onClick:u=>{!u.ctrlKey&&!u.metaKey&&!u.shiftKey&&u.button===0&&(u.preventDefault(),r(!0))},children:a})})}),e.jsxs(Ze,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(et,{children:[e.jsx(tt,{children:"File Previewer"}),e.jsxs(st,{children:["Displaying file: ",e.jsx("span",{className:"font-mono text-sm text-gray-600 break-all",children:i})]})]}),e.jsx("div",{className:"py-4",children:e.jsx(De,{item:t})})]})]})},rt=({storage:t,partnerId:a,collectionId:o})=>{const[r,i]=l.useState(null),[d,u]=l.useState(null),[x,p]=l.useState([]),[v,h]=l.useState(""),[P,N]=l.useState("table"),[C,n]=l.useState(!1);l.useEffect(()=>{if(t&&t.length>0){const s=t[t.length-1],c=t.slice(0,t.length-1).filter(f=>!!f.url);w(s),p(c),u(null),h("")}},[t]),l.useEffect(()=>{const s=c=>{c.state&&(p(c.state.history),i(c.state.currentData))};return window.addEventListener("popstate",s),()=>{window.removeEventListener("popstate",s)}},[]),l.useEffect(()=>{if(r&&r.url){const s=`/fs/paths/${a}/${o}`;let c="";if(r.url===s)c=`/collections/${o}`;else if(r.url.startsWith(s+"/")){const f=r.url.substring(s.length+1);c=`/paths/${a}/${o}/${f}`}else c=`/collections/${o}`;window.history.pushState({history:x,currentData:r},"",c)}},[r,x,a,o,t]);const w=async s=>{n(!0);try{if(!s.url){console.error("Error: Attempted to fetch data for an item with no URL:",s);return}const f=await(await fetch(s.url)).json();i(f)}finally{n(!1)}},y=async s=>{if(s.object_type==="directory"){if(n(!0),!s.url){console.error("Error: Clicked directory has no URL:",s),n(!1);return}const f=await(await fetch(s.url)).json();r&&(r.object_type==="directory"&&!r.url&&console.warn("Warning: Attempting to add a directory to history without a URL:",r),p(_=>[..._,r])),i(f),h(""),u(null),n(!1)}else u(s.name)},H=async s=>{n(!0);const c=x[s];if(!c||!c.url){console.error("Error: Target history item has no URL or is null:",c),n(!1);return}const f=x.slice(0,s);await w(c),p(f),u(null),h(""),n(!1)},A=s=>new Date(s).toLocaleString(),J=s=>s.object_type==="file"&&s.size!==void 0&&s.size<2*1024*1024*1024;if(C)return e.jsx(Ve,{});if(!r)return e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"No data"});const z=(r.children||[]).filter(s=>s.name.toLowerCase().includes(v.toLowerCase()));return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-2 text-sm text-muted-foreground flex flex-wrap items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:"Path:"}),x.map((s,c)=>e.jsxs("span",{className:"flex items-center",children:[s.url?e.jsx("button",{onClick:()=>H(c),className:"text-primary cursor-pointer underline hover:text-primary/80",title:s.name,children:s.name}):e.jsx("span",{className:"text-muted-foreground",title:`Unnavigable: ${s.name}`,children:s.name}),e.jsx(U,{className:"w-4 h-4 text-muted-foreground/50 mx-1"})]},s.url||c)),r.name&&e.jsx("span",{title:r.name,children:r.name})]}),e.jsx("div",{className:"flex items-center justify-between mb-4 gap-4 flex-wrap",children:e.jsxs("div",{className:"relative max-w-sm w-full",children:[e.jsx($e,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{type:"text",placeholder:"Filter files or folders...",value:v,onChange:s=>h(s.target.value),className:"pl-8"})]})}),z.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Empty directory."}):e.jsx("div",{className:"overflow-x-auto border rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-muted text-left sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium",children:"Name"}),e.jsx("th",{className:"p-2 font-medium",children:"Type"}),e.jsx("th",{className:"p-2 font-medium",children:"Size"}),e.jsx("th",{className:"p-2 font-medium",children:"Preview"}),e.jsx("th",{className:"p-2 font-medium",children:"Download"}),e.jsx("th",{className:"p-2 font-medium",children:"Last Modified"}),e.jsx("th",{className:"p-2 font-medium"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:z.map((s,c)=>{const f=c%2===0,_=b(f?"bg-background":"bg-muted/50","hover:bg-accent",s.object_type==="directory"&&"cursor-pointer",d===s.name&&"ring ring-primary");if(s.preview=!1,s.size&&s.size>0&&s.mime_type)switch(s.mime_type){case"application/xml":case"application/json":case"text/plain":case"text/csv":case"text/xsl":case"application/xslt+xml":case"audio/wav":case"audio/mpeg":case"audio/ogg":case"audio/aac":case"video/mp4":case"video/webm":case"video/ogg":case"text/html":s.preview=!0;break}return s.object_type==="file"?e.jsxs("tr",{className:_,tabIndex:0,children:[e.jsx("td",{className:"p-2 max-w-xs",title:s.name,children:s.name}),e.jsx("td",{className:"p-2",children:s.object_type}),e.jsx("td",{className:"p-2",children:s.display_size}),e.jsx("td",{className:"p-2",children:s.preview&&s.download_url?e.jsx(at,{item:s,triggerLabel:"Preview"}):e.jsx("div",{children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsx("span",{className:"text-muted-foreground/50",children:"Not available"})}),e.jsx(I,{children:e.jsx("span",{children:"Unavailable at the moment — please check back soon."})})]})})}),e.jsx("td",{className:"p-2",children:J(s)&&s.download_url?e.jsx("a",{href:s.download_url,className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Download"}):e.jsxs(F,{children:[e.jsx(M,{children:e.jsx("span",{className:"text-muted-foreground/50",children:"N/A"})}),e.jsx(I,{children:e.jsx("span",{children:"Download for files over 2GB of size is not currently supported."})})]})}),e.jsx("td",{className:"p-2",children:A(s.last_modified)}),e.jsx("td",{className:"p-2"})]},s.name):e.jsxs("tr",{className:_,onClick:()=>y(s),tabIndex:0,children:[e.jsx("td",{className:"p-2 truncate max-w-xs",title:s.name,children:s.name}),e.jsx("td",{className:"p-2",children:s.object_type}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2",children:A(s.last_modified)}),e.jsx("td",{className:"p-2",children:e.jsx(U,{size:24,className:"text-gray-400"})})]},s.name)})})]})})]})};function jt(){const{collection:t,storage_path:a}=Z().props,{partner:o}=t,{collectionDetailsCollapsed:r}=ee(),[i,d]=l.useState(!r);l.useEffect(()=>{d(!r)},[r]);const u=[{title:"Partners",href:"/dashboard"},{title:o.name,href:`/partners/${o.id}`},{title:t.name,href:`/collections/${t.id}`}];return e.jsxs(ve,{breadcrumbs:u,children:[e.jsx(te,{title:`${t.name} - ${o.name}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto",children:[e.jsx("h4",{className:"scroll-m-20 text-xl font-semibold tracking-tight",children:t.name}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx(Ne,{children:e.jsxs(be,{children:[e.jsx(we,{asChild:!0,children:e.jsxs(W,{onClick:()=>d(!i),variant:"ghost",className:"w-full flex justify-between items-center px-4 py-2 cursor-pointer",children:[e.jsx("h5",{className:"scroll-m-20 text-l font-semibold tracking-tight",children:"Collection Details"}),i?e.jsx(Oe,{}):e.jsx(ke,{})]})}),e.jsx(Ce,{children:e.jsxs("p",{children:["Click to ",i?"collapse":"expand"," collection details"]})})]})}),i&&e.jsx(Re,{id:"collection-details-table",className:"w-full",children:e.jsxs(Te,{children:[e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Partner Name"}),e.jsx(m,{children:o.name})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Partner Code"}),e.jsx(m,{children:o.code})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Partner R* Path"}),e.jsx(m,{children:o.path})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Collection Long Name"}),e.jsx(m,{children:t.name})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Collection Code"}),e.jsx(m,{children:t.display_code})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Collection R* Code"}),e.jsx(m,{children:t.code})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"R* Path"}),e.jsx(m,{children:t.path})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Ready for Content?"}),e.jsx(m,{children:t.ready_for_content?"Yes":"No"})]}),e.jsxs(j,{children:[e.jsx(m,{className:"font-medium",children:"Quota (GB)"}),e.jsx(m,{children:t.quota.toLocaleString()})]})]})})]}),e.jsx("h5",{className:"scroll-m-20 text-l font-semibold tracking-tight",children:"Perspectives"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(rt,{storage:a,partnerId:String(o.id),collectionId:String(t.id)})})]})]})}export{jt as default};
